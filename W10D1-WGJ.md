# W10D1笔记 —— Tomasulo Organization

## 问题引入

五级流水中，指令严格按照顺序发射、执行。因此，当流水线中相邻很近的两条指令存在相关性，就会产生data hazard，导致bubble停顿，降低效率。因此需要乱序执行，这会导致data hazard: **WAR, WAW, RAW**。

## 解决方法 —— Renaming

### 硬件上重命名

把指令翻译成微指令时，进行重命名，arch reg -> micro reg。

### 软件上重命名

编译器进行重命名。

### 记分牌算法

用指令的目标寄存器编号，作为后续指令需要获取的寄存器的标签。这样，**对于RAW问题，可以实现乱序执行**，因为如果R在W之前发射，那么R会依赖于W的目标寄存器，根据W的寄存器编号，会一直等待直至W正常完成。

但是，记分牌算法的缺点是显然的——它无法解决WAW和WAR这种pseudo问题。这是因为，对于同一寄存器，会进行多次修改，因此只用寄存器编号无法解决这种问题。

### Tomasulo算法

在记分牌算法的基础上，用指令的编号，作为后续指令需要获取的寄存器的标签。这样，将每次修改落在指令上，便**可以解决WAW和WAR问题**。

![](https://notes.sjtu.edu.cn/uploads/upload_970f3a8f27df9bbb60e0ad65f4dfcc3c.png)

一些部件：

* ROB：保证指令在提交是保序的
* RS：用于保留指令，等待寄存器数据准备完毕后执行ALU运算
* LSB：用于保证内存访问（确切地说，是写操作）顺序

#### Tomasulo算法的执行过程

* 1.Issue。fetch相应指令，并将其分发发射到各个部件中。
* 2.Execute。RS，ALU等进行相应的计算。
* 3.Commit。修改RF中的寄存器值，进行相应的MEM写，进行CDB广播。

#### 精确中断

利用ROB的保序性，可以实现精确中断。

