# W14D1笔记 —— Review

## Pipeline

### Hazard

#### 1. 结构冒险（Structural Hazard）

**定义：** 结构冒险发生在硬件资源的冲突上，即多个指令同时需要访问相同的硬件模块，但硬件无法同时服务它们。

**示例：** 在单一存储器模块的体系结构中，同时进行取指令（Instruction Fetch）和写回操作（Write Back）可能导致结构冒险。

**解决方法：** 增加硬件资源，例如多个数据通路或多个存储器模块，以避免资源的竞争。

#### 2. 数据冒险（Data Hazard）

**定义：** 数据冒险发生在程序中的指令之间存在数据依赖关系，导致某些指令需要等待前面的指令完成才能执行。

**示例：** 
- **读后写数据冒险（Read After Write Dependency）：** 指令 A 写回的结果是指令 B 读取的操作数，但指令 B 在指令 A 写回前执行。
- **写后写数据冒险（Write After Write Dependency）：** 多个指令试图同时写入相同的目标，导致其中一个指令的写入结果被覆盖。

**解决方法：** 
- 使用数据前推（Data Forwarding）或旁路技术，将写回的结果直接传递给等待的指令。
- 插入流水线暂停或空闲周期，使相关的指令能够正确执行。

#### 3. 控制冒险（Control Hazard）

**定义：** 控制冒险发生在程序的控制流发生改变，例如分支或跳转指令导致了不确定的下一条指令。

**示例：** 
- **分支冒险（Branch Hazard）：** 当一个分支指令的条件判断结果确定后，需要选择正确的分支目标，而之前的指令已经进入流水线，可能导致错误的分支目标的指令被执行。

**解决方法：** 
- 使用预测技术，例如分支预测（Branch Prediction），通过猜测分支的方向来提前执行下一条指令。
- 在分支预测失败时，使用流水线刷新或插入无效指令来纠正控制流。
### 乱序

* 问题: 精准中断，跳转
* 解决: ROB保证提交顺序
* Tomasulo: Issue -> execute -> commit

### Cache & Memory

 $AMAT_{cache} = T_{hit} +\eta_{miss-rate}*T_{penalty}$
 
  $AMAT_{mem} = T_{addr} +T_{access}+T_{trans}$