# Week3 Day1

流水线的原理看似简单，但是在计算机上实现时，却有可能出现以下三种风险：

## 1.Structural hazards：

硬件可能无法支持这些构想的指令的组合，可能在现实中实现时会有困难。

## 2.Data hazards：

可能会出现数据冲突的情况，有三种常见的数据冲突形式：

1.Read After Write (RAW)

由流水线可以得知，寄存器的写入操作是发生在五级流水的最后一步，那么如果有指令要使用这个寄存器的值，则会出现冲突。

2.Write After Read (WAR)

在五级流水中，不会发生这种情况，因为read总是在第二步，而write在第五步。但是在其它构型中，可能会发生这样的冲突。

3.Write After Write (WAW)

在五级流水中，也不会发生这样的情况，因为所有的指令都要经历五步，而write指令总是在第五步，因此指令顺序靠后的指令也总是靠后执行。

五级流水中的RAW主要有以下三种解决方式：

第一种，也就是最直接的解决方式是加很多bubble，直到寄存器的值计算出来再继续计算下一条指令。但是这样会浪费多级流水的潜能。

第二种，是从硬件上进行解决，由硬件发出信号来将产生的数据提前传输给需要使用的部件。但是这样会使得硬件布线复杂，有一定技术要求。

第三种，是通过软件上的安排。如一定程度上的乱序执行，如Tomasulo乱序执行，从而减少数据的依赖。

## 3.Control hazards：

这种风险产生的原因是抓取指令和决定跳转（即branches and jumps）总是有延迟的。在不知道往哪跳转之前，有工作单位是空闲的，抓取指令依然要进行。

一种方法是采用分支预测的办法，预测下一步是跳转还是继续运行。好处是预测对了，则冲突不会发生，且资源不会浪费。坏处是如果预测错了，会浪费大量的周期。

另一种方法是寻找无论跳转与否都要执行的指令进行填充。好处是最大限度的避免周期的浪费。坏处是无法找到足够多的有效的指令进行填充，同时可能出现冲突问题。