### Week 3 Day 1

#### Harzard 问题

##### 结构 Harzard

流水不能减少 latency, 但是可以增大 throughput.

结构 Harzard 是各部件之间所用时间不平衡导致的问题.

##### 数据 Harzard

WAW，RAW，WAR 等问题，即数据依赖

基本解决思路是：
- 硬件上，分析指令之间的距离，使用前向forwarding。
- 软件上，编译器优化代码，安排代码顺序，减少数据依赖产生的等待。

##### 控制 Harzard

分支指令导致控制流的改变，导致流水线中的指令无法顺利执行。

紧跟分支后的指令可能被错误执行。

跳转的处理：清空锁存器、流水线，重置为nop指令；

如何阻止harzard：

- delay slot: 找到指令填充在跳转指令后面。
有两种方法实现这项技术：编译和cpu。
但是该方法的效率只有大约 50%，
问题是很多情况下找不到指令来填充。
因为 BasicBlock 通常较小，无法找到。
对于超标量处理器，效率更低。

- 内存 barrier: 遇到br后给内存加锁

branch 会导致性能下降，如何优化？

- 尽早判断
- 加速挑战后的地址判断

思考：有没有可能不使用条件分支指令来写程序？函数式？
A: 一种方法是条件执行指令


### 故事：

梁阿磊老师反对搞AI.

侯博涵：从AI转向机器学习**编译**。

造计算机：
- 体系结构
- 编译器
- 操作系统
